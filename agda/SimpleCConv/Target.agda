{-# OPTIONS --without-K #-}

module Target where

open import Lib
open import Data.Bool

infixr 4 _â‡’_ _â‡’âº_ _â–¶_
infixr 5 _*_

data Ty : Set where
  ğ”¹   : Ty
  Top  : Ty
  _*_  : Ty â†’ Ty â†’ Ty
  _â‡’âº_ : Ty â†’ Ty â†’ Ty
  _â‡’_  : Ty â†’ Ty â†’ Ty

data Con : Set where
  âˆ™   : Con
  _â–¶_ : Con â†’ Ty â†’ Con

data _âˆˆ_ (A : Ty) : Con â†’ Set where
  vz : âˆ€ {Î“} â†’ A âˆˆ (Î“ â–¶ A)
  vs : âˆ€ {B Î“} â†’ A âˆˆ Î“ â†’ A âˆˆ (Î“ â–¶ B)

data Tm Î“ : Ty â†’ Set where
  var  : âˆ€ {A} â†’ A âˆˆ Î“ â†’ Tm Î“ A
  tt   : Tm Î“ Top

  true false : Tm Î“ ğ”¹
  if   : âˆ€ {A} â†’ Tm Î“ ğ”¹ â†’ Tm Î“ A â†’ Tm Î“ A â†’ Tm Î“ A

  Ï€â‚   : âˆ€ {A B} â†’ Tm Î“ (A * B) â†’ Tm Î“ A
  Ï€â‚‚   : âˆ€ {A B} â†’ Tm Î“ (A * B) â†’ Tm Î“ B
  _,_  : âˆ€ {A B} â†’ Tm Î“ A â†’ Tm Î“ B â†’ Tm Î“ (A * B)

  pack : âˆ€ {E A B} â†’ Tm Î“ E â†’ Tm Î“ (E * A â‡’ B) â†’ Tm Î“ (A â‡’âº B)
  appâº : âˆ€ {A B} â†’ Tm Î“ (A â‡’âº B) â†’ Tm Î“ A â†’ Tm Î“ B

  lam  : âˆ€ {A B} â†’ Tm (âˆ™ â–¶ A) B â†’ Tm Î“ (A â‡’ B)
  app  : âˆ€ {A B} â†’ Tm Î“ (A â‡’ B) â†’ Tm Î“ A â†’ Tm Î“ B


-- Embedding
--------------------------------------------------------------------------------

-- Order-preserving embedding
data OPE : Con â†’ Con â†’ Set where
  âˆ™    : OPE âˆ™ âˆ™
  drop : âˆ€ {A Î“ Î”} â†’ OPE Î“ Î” â†’ OPE (Î“ â–¶ A) Î”
  keep : âˆ€ {A Î“ Î”} â†’ OPE Î“ Î” â†’ OPE (Î“ â–¶ A) (Î” â–¶ A)

-- OPE is a category
idâ‚‘ : âˆ€ {Î“} â†’ OPE Î“ Î“
idâ‚‘ {âˆ™}     = âˆ™
idâ‚‘ {Î“ â–¶ A} = keep (idâ‚‘ {Î“})

wk : âˆ€ {A Î“} â†’ OPE (Î“ â–¶ A) Î“
wk = drop idâ‚‘

_âˆ˜â‚‘_ : âˆ€ {Î“ Î” Î£} â†’ OPE Î” Î£ â†’ OPE Î“ Î” â†’ OPE Î“ Î£
Ïƒ      âˆ˜â‚‘ âˆ™      = Ïƒ
Ïƒ      âˆ˜â‚‘ drop Î´ = drop (Ïƒ âˆ˜â‚‘ Î´)
drop Ïƒ âˆ˜â‚‘ keep Î´ = drop (Ïƒ âˆ˜â‚‘ Î´)
keep Ïƒ âˆ˜â‚‘ keep Î´ = keep (Ïƒ âˆ˜â‚‘ Î´)

idlâ‚‘ : âˆ€ {Î“ Î”}(Ïƒ : OPE Î“ Î”) â†’ idâ‚‘ âˆ˜â‚‘ Ïƒ â‰¡ Ïƒ
idlâ‚‘ âˆ™        = refl
idlâ‚‘ (drop Ïƒ) = drop & idlâ‚‘ Ïƒ
idlâ‚‘ (keep Ïƒ) = keep & idlâ‚‘ Ïƒ

idrâ‚‘ : âˆ€ {Î“ Î”}(Ïƒ : OPE Î“ Î”) â†’ Ïƒ âˆ˜â‚‘ idâ‚‘ â‰¡ Ïƒ
idrâ‚‘ âˆ™        = refl
idrâ‚‘ (drop Ïƒ) = drop & idrâ‚‘ Ïƒ
idrâ‚‘ (keep Ïƒ) = keep & idrâ‚‘ Ïƒ

assâ‚‘ :
  âˆ€ {Î“ Î” Î£ Î}(Ïƒ : OPE Î£ Î)(Î´ : OPE Î” Î£)(Î½ : OPE Î“ Î”)
  â†’ (Ïƒ âˆ˜â‚‘ Î´) âˆ˜â‚‘ Î½ â‰¡ Ïƒ âˆ˜â‚‘ (Î´ âˆ˜â‚‘ Î½)
assâ‚‘ Ïƒ        Î´        âˆ™        = refl
assâ‚‘ Ïƒ        Î´        (drop Î½) = drop & assâ‚‘ Ïƒ Î´ Î½
assâ‚‘ Ïƒ        (drop Î´) (keep Î½) = drop & assâ‚‘ Ïƒ Î´ Î½
assâ‚‘ (drop Ïƒ) (keep Î´) (keep Î½) = drop & assâ‚‘ Ïƒ Î´ Î½
assâ‚‘ (keep Ïƒ) (keep Î´) (keep Î½) = keep & assâ‚‘ Ïƒ Î´ Î½

-- (A âˆˆ_) : PSh OPE
âˆˆâ‚‘ : âˆ€ {A Î“ Î”} â†’ OPE Î“ Î” â†’ A âˆˆ Î” â†’ A âˆˆ Î“
âˆˆâ‚‘ âˆ™        v      = v
âˆˆâ‚‘ (drop Ïƒ) v      = vs (âˆˆâ‚‘ Ïƒ v)
âˆˆâ‚‘ (keep Ïƒ) vz     = vz
âˆˆâ‚‘ (keep Ïƒ) (vs v) = vs (âˆˆâ‚‘ Ïƒ v)

âˆˆ-idâ‚‘ : âˆ€ {A Î“}(v : A âˆˆ Î“) â†’ âˆˆâ‚‘ idâ‚‘ v â‰¡ v
âˆˆ-idâ‚‘ vz     = refl
âˆˆ-idâ‚‘ (vs v) = vs & âˆˆ-idâ‚‘ v

âˆˆ-âˆ˜â‚‘ : âˆ€ {A Î“ Î” Î£}(Ïƒ : OPE Î” Î£)(Î´ : OPE Î“ Î”)(v : A âˆˆ Î£) â†’ âˆˆâ‚‘ (Ïƒ âˆ˜â‚‘ Î´) v â‰¡ âˆˆâ‚‘ Î´ (âˆˆâ‚‘ Ïƒ v)
âˆˆ-âˆ˜â‚‘ âˆ™        âˆ™        v      = refl
âˆˆ-âˆ˜â‚‘ Ïƒ        (drop Î´) v      = vs & âˆˆ-âˆ˜â‚‘ Ïƒ Î´ v
âˆˆ-âˆ˜â‚‘ (drop Ïƒ) (keep Î´) v      = vs & âˆˆ-âˆ˜â‚‘ Ïƒ Î´ v
âˆˆ-âˆ˜â‚‘ (keep Ïƒ) (keep Î´) vz     = refl
âˆˆ-âˆ˜â‚‘ (keep Ïƒ) (keep Î´) (vs v) = vs & âˆˆ-âˆ˜â‚‘ Ïƒ Î´ v

-- (Tm _ A) : PSh OPE
Tmâ‚‘ : âˆ€ {A Î“ Î”} â†’ OPE Î“ Î” â†’ Tm Î” A â†’ Tm Î“ A
Tmâ‚‘ Ïƒ tt         = tt
Tmâ‚‘ Ïƒ (t , u)    = Tmâ‚‘ Ïƒ t , Tmâ‚‘ Ïƒ u
Tmâ‚‘ Ïƒ (Ï€â‚ t)     = Ï€â‚ (Tmâ‚‘ Ïƒ t)
Tmâ‚‘ Ïƒ (Ï€â‚‚ t)     = Ï€â‚‚ (Tmâ‚‘ Ïƒ t)
Tmâ‚‘ Ïƒ (pack e t) = pack (Tmâ‚‘ Ïƒ e) (Tmâ‚‘ Ïƒ t)
Tmâ‚‘ Ïƒ (appâº t u) = appâº (Tmâ‚‘ Ïƒ t) (Tmâ‚‘ Ïƒ u)
Tmâ‚‘ Ïƒ (if t u v) = if (Tmâ‚‘ Ïƒ t) (Tmâ‚‘ Ïƒ u) (Tmâ‚‘ Ïƒ v)
Tmâ‚‘ Ïƒ false      = false
Tmâ‚‘ Ïƒ true       = true
Tmâ‚‘ Ïƒ (var v)    = var (âˆˆâ‚‘ Ïƒ v)
Tmâ‚‘ Ïƒ (lam t)    = lam t
Tmâ‚‘ Ïƒ (app f a)  = app (Tmâ‚‘ Ïƒ f) (Tmâ‚‘ Ïƒ a)

Tm-idâ‚‘ : âˆ€ {A Î“}(t : Tm Î“ A) â†’ Tmâ‚‘ idâ‚‘ t â‰¡ t
Tm-idâ‚‘ tt         = refl
Tm-idâ‚‘ (t , u)    = _,_ & Tm-idâ‚‘ t âŠ— Tm-idâ‚‘ u
Tm-idâ‚‘ (Ï€â‚ t)     = Ï€â‚ & Tm-idâ‚‘ t
Tm-idâ‚‘ (Ï€â‚‚ t)     = Ï€â‚‚ & Tm-idâ‚‘ t
Tm-idâ‚‘ (pack e t) = pack & Tm-idâ‚‘ e âŠ— Tm-idâ‚‘ t
Tm-idâ‚‘ (appâº t u) = appâº & Tm-idâ‚‘ t âŠ— Tm-idâ‚‘ u
Tm-idâ‚‘ (if t u v) = if & Tm-idâ‚‘ t âŠ— Tm-idâ‚‘ u âŠ— Tm-idâ‚‘ v
Tm-idâ‚‘ false      = refl
Tm-idâ‚‘ true       = refl
Tm-idâ‚‘ (var v)    = var & âˆˆ-idâ‚‘ v
Tm-idâ‚‘ (lam t)    = refl
Tm-idâ‚‘ (app f a)  = app & Tm-idâ‚‘ f âŠ— Tm-idâ‚‘ a

Tm-âˆ˜â‚‘ : âˆ€ {A Î“ Î” Î£}(Ïƒ : OPE Î” Î£)(Î´ : OPE Î“ Î”)(t : Tm Î£ A) â†’ Tmâ‚‘ (Ïƒ âˆ˜â‚‘ Î´) t â‰¡ Tmâ‚‘ Î´ (Tmâ‚‘ Ïƒ t)
Tm-âˆ˜â‚‘ Ïƒ Î´ tt         = refl
Tm-âˆ˜â‚‘ Ïƒ Î´ (t , u)    = _,_ & Tm-âˆ˜â‚‘ Ïƒ Î´ t âŠ— Tm-âˆ˜â‚‘ Ïƒ Î´ u
Tm-âˆ˜â‚‘ Ïƒ Î´ (Ï€â‚ t)     = Ï€â‚ & Tm-âˆ˜â‚‘ Ïƒ Î´ t
Tm-âˆ˜â‚‘ Ïƒ Î´ (Ï€â‚‚ t)     = Ï€â‚‚ & Tm-âˆ˜â‚‘ Ïƒ Î´ t
Tm-âˆ˜â‚‘ Ïƒ Î´ (pack e t) = pack & Tm-âˆ˜â‚‘ Ïƒ Î´ e âŠ— Tm-âˆ˜â‚‘ Ïƒ Î´ t
Tm-âˆ˜â‚‘ Ïƒ Î´ (appâº t u) = appâº & Tm-âˆ˜â‚‘ Ïƒ Î´ t âŠ— Tm-âˆ˜â‚‘ Ïƒ Î´ u
Tm-âˆ˜â‚‘ Î£ Î´ (if t u v) = if & Tm-âˆ˜â‚‘ Î£ Î´ t âŠ— Tm-âˆ˜â‚‘ Î£ Î´ u âŠ— Tm-âˆ˜â‚‘ Î£ Î´ v
Tm-âˆ˜â‚‘ Î£ Î´ false      = refl
Tm-âˆ˜â‚‘ Î£ Î´ true       = refl
Tm-âˆ˜â‚‘ Ïƒ Î´ (var v)    = var & âˆˆ-âˆ˜â‚‘ Ïƒ Î´ v
Tm-âˆ˜â‚‘ Ïƒ Î´ (lam t)    = refl
Tm-âˆ˜â‚‘ Ïƒ Î´ (app f a)  = app & Tm-âˆ˜â‚‘ Ïƒ Î´ f âŠ— Tm-âˆ˜â‚‘ Ïƒ Î´ a

-- Theory of substitution & embedding
--------------------------------------------------------------------------------

infixr 6 _â‚‘âˆ˜â‚›_ _â‚›âˆ˜â‚‘_ _âˆ˜â‚›_

data Sub (Î“ : Con) : Con â†’ Set where
  âˆ™   : Sub Î“ âˆ™
  _,_ : âˆ€ {A : Ty}{Î” : Con} â†’ Sub Î“ Î” â†’ Tm Î“ A â†’ Sub Î“ (Î” â–¶ A)

_â‚›âˆ˜â‚‘_ : âˆ€ {Î“ Î” Î£} â†’ Sub Î” Î£ â†’ OPE Î“ Î” â†’ Sub Î“ Î£
âˆ™       â‚›âˆ˜â‚‘ Î´ = âˆ™
(Ïƒ , t) â‚›âˆ˜â‚‘ Î´ = Ïƒ â‚›âˆ˜â‚‘ Î´ , Tmâ‚‘ Î´ t

_â‚‘âˆ˜â‚›_ : âˆ€ {Î“ Î” Î£} â†’ OPE Î” Î£ â†’ Sub Î“ Î” â†’ Sub Î“ Î£
âˆ™      â‚‘âˆ˜â‚› Î´       = Î´
drop Ïƒ â‚‘âˆ˜â‚› (Î´ , t) = Ïƒ â‚‘âˆ˜â‚› Î´
keep Ïƒ â‚‘âˆ˜â‚› (Î´ , t) = Ïƒ â‚‘âˆ˜â‚› Î´ , t

dropâ‚› : âˆ€ {A Î“ Î”} â†’ Sub Î“ Î” â†’ Sub (Î“ â–¶ A) Î”
dropâ‚› Ïƒ = Ïƒ â‚›âˆ˜â‚‘ wk

keepâ‚› : âˆ€ {A Î“ Î”} â†’ Sub Î“ Î” â†’ Sub (Î“ â–¶ A) (Î” â–¶ A)
keepâ‚› Ïƒ = dropâ‚› Ïƒ , var vz

âŒœ_âŒáµ’áµ–áµ‰ : âˆ€ {Î“ Î”} â†’ OPE Î“ Î” â†’ Sub Î“ Î”
âŒœ âˆ™      âŒáµ’áµ–áµ‰ = âˆ™
âŒœ drop Ïƒ âŒáµ’áµ–áµ‰ = dropâ‚› âŒœ Ïƒ âŒáµ’áµ–áµ‰
âŒœ keep Ïƒ âŒáµ’áµ–áµ‰ = keepâ‚› âŒœ Ïƒ âŒáµ’áµ–áµ‰

âˆˆâ‚› : âˆ€ {A Î“ Î”} â†’ Sub Î“ Î” â†’ A âˆˆ Î” â†’ Tm Î“ A
âˆˆâ‚› (Ïƒ , t) vz     = t
âˆˆâ‚› (Ïƒ  , t)(vs v) = âˆˆâ‚› Ïƒ v

Tmâ‚› : âˆ€ {A Î“ Î”} â†’ Sub Î“ Î” â†’ Tm Î” A â†’ Tm Î“ A
Tmâ‚› Ïƒ tt         = tt
Tmâ‚› Ïƒ (t , u)    = Tmâ‚› Ïƒ t , Tmâ‚› Ïƒ u
Tmâ‚› Ïƒ (Ï€â‚ t)     = Ï€â‚ (Tmâ‚› Ïƒ t)
Tmâ‚› Ïƒ (Ï€â‚‚ t)     = Ï€â‚‚ (Tmâ‚› Ïƒ t)
Tmâ‚› Ïƒ (pack e t) = pack (Tmâ‚› Ïƒ e) (Tmâ‚› Ïƒ t)
Tmâ‚› Ïƒ (appâº t u) = appâº (Tmâ‚› Ïƒ t) (Tmâ‚› Ïƒ u)
Tmâ‚› Ïƒ (if t u v) = if (Tmâ‚› Ïƒ t) (Tmâ‚› Ïƒ u) (Tmâ‚› Ïƒ v)
Tmâ‚› Ïƒ false      = false
Tmâ‚› Ïƒ true       = true
Tmâ‚› Ïƒ (var v)    = âˆˆâ‚› Ïƒ v
Tmâ‚› Ïƒ (lam t)    = lam t
Tmâ‚› Ïƒ (app f a)  = app (Tmâ‚› Ïƒ f) (Tmâ‚› Ïƒ a)

idâ‚› : âˆ€ {Î“} â†’ Sub Î“ Î“
idâ‚› {âˆ™}     = âˆ™
idâ‚› {Î“ â–¶ A} = (idâ‚› {Î“} â‚›âˆ˜â‚‘ drop idâ‚‘) , var vz

_âˆ˜â‚›_ : âˆ€ {Î“ Î” Î£} â†’ Sub Î” Î£ â†’ Sub Î“ Î” â†’ Sub Î“ Î£
âˆ™       âˆ˜â‚› Î´ = âˆ™
(Ïƒ , t) âˆ˜â‚› Î´ = Ïƒ âˆ˜â‚› Î´ , Tmâ‚› Î´ t

assâ‚›â‚‘â‚‘ :
  âˆ€ {Î“ Î” Î£ Î}(Ïƒ : Sub Î£ Î)(Î´ : OPE Î” Î£)(Î½ : OPE Î“ Î”)
  â†’ (Ïƒ â‚›âˆ˜â‚‘ Î´) â‚›âˆ˜â‚‘ Î½ â‰¡ Ïƒ â‚›âˆ˜â‚‘ (Î´ âˆ˜â‚‘ Î½)
assâ‚›â‚‘â‚‘ âˆ™       Î´ Î½ = refl
assâ‚›â‚‘â‚‘ (Ïƒ , t) Î´ Î½ = _,_ & assâ‚›â‚‘â‚‘ Ïƒ Î´ Î½ âŠ— (Tm-âˆ˜â‚‘ Î´ Î½ t â»Â¹)

assâ‚‘â‚›â‚‘ :
  âˆ€ {Î“ Î” Î£ Î}(Ïƒ : OPE Î£ Î)(Î´ : Sub Î” Î£)(Î½ : OPE Î“ Î”)
  â†’ (Ïƒ â‚‘âˆ˜â‚› Î´) â‚›âˆ˜â‚‘ Î½ â‰¡ Ïƒ â‚‘âˆ˜â‚› (Î´ â‚›âˆ˜â‚‘ Î½)
assâ‚‘â‚›â‚‘ âˆ™        Î´       Î½ = refl
assâ‚‘â‚›â‚‘ (drop Ïƒ) (Î´ , t) Î½ = assâ‚‘â‚›â‚‘ Ïƒ Î´ Î½
assâ‚‘â‚›â‚‘ (keep Ïƒ) (Î´ , t) Î½ = (_, Tmâ‚‘ Î½ t) & assâ‚‘â‚›â‚‘ Ïƒ Î´ Î½

idlâ‚‘â‚› : âˆ€ {Î“ Î”}(Ïƒ : Sub Î“ Î”) â†’ idâ‚‘ â‚‘âˆ˜â‚› Ïƒ â‰¡ Ïƒ
idlâ‚‘â‚› âˆ™       = refl
idlâ‚‘â‚› (Ïƒ , t) = (_, t) & idlâ‚‘â‚› Ïƒ

idlâ‚›â‚‘ : âˆ€ {Î“ Î”}(Ïƒ : OPE Î“ Î”) â†’ idâ‚› â‚›âˆ˜â‚‘ Ïƒ â‰¡ âŒœ Ïƒ âŒáµ’áµ–áµ‰
idlâ‚›â‚‘ âˆ™        = refl
idlâ‚›â‚‘ (drop Ïƒ) =
      ((idâ‚› â‚›âˆ˜â‚‘_) âˆ˜ drop) & idrâ‚‘ Ïƒ â»Â¹
    â—¾ assâ‚›â‚‘â‚‘ idâ‚› Ïƒ wk â»Â¹
    â—¾ dropâ‚› & idlâ‚›â‚‘ Ïƒ
idlâ‚›â‚‘ (keep Ïƒ) =
  (_, var vz) &
      (assâ‚›â‚‘â‚‘ idâ‚› wk (keep Ïƒ)
    â—¾ ((idâ‚› â‚›âˆ˜â‚‘_) âˆ˜ drop) & (idlâ‚‘ Ïƒ â—¾ idrâ‚‘ Ïƒ â»Â¹)
    â—¾ assâ‚›â‚‘â‚‘ idâ‚› Ïƒ wk â»Â¹
    â—¾ (_â‚›âˆ˜â‚‘ wk) & idlâ‚›â‚‘ Ïƒ )

idrâ‚‘â‚› : âˆ€ {Î“ Î”}(Ïƒ : OPE Î“ Î”) â†’ Ïƒ â‚‘âˆ˜â‚› idâ‚› â‰¡ âŒœ Ïƒ âŒáµ’áµ–áµ‰
idrâ‚‘â‚› âˆ™        = refl
idrâ‚‘â‚› (drop Ïƒ) = assâ‚‘â‚›â‚‘ Ïƒ idâ‚› wk â»Â¹ â—¾ dropâ‚› & idrâ‚‘â‚› Ïƒ
idrâ‚‘â‚› (keep Ïƒ) = (_, var vz) & (assâ‚‘â‚›â‚‘ Ïƒ idâ‚› wk â»Â¹ â—¾ (_â‚›âˆ˜â‚‘ wk) & idrâ‚‘â‚› Ïƒ)

âˆˆ-â‚‘âˆ˜â‚› : âˆ€ {A Î“ Î” Î£}(Ïƒ : OPE Î” Î£)(Î´ : Sub Î“ Î”)(v : A âˆˆ Î£) â†’ âˆˆâ‚› (Ïƒ â‚‘âˆ˜â‚› Î´) v â‰¡ âˆˆâ‚› Î´ (âˆˆâ‚‘ Ïƒ v)
âˆˆ-â‚‘âˆ˜â‚› âˆ™        Î´       v      = refl
âˆˆ-â‚‘âˆ˜â‚› (drop Ïƒ) (Î´ , t) v      = âˆˆ-â‚‘âˆ˜â‚› Ïƒ Î´ v
âˆˆ-â‚‘âˆ˜â‚› (keep Ïƒ) (Î´ , t) vz     = refl
âˆˆ-â‚‘âˆ˜â‚› (keep Ïƒ) (Î´ , t) (vs v) = âˆˆ-â‚‘âˆ˜â‚› Ïƒ Î´ v

Tm-â‚‘âˆ˜â‚› : âˆ€ {A Î“ Î” Î£}(Ïƒ : OPE Î” Î£)(Î´ : Sub Î“ Î”)(t : Tm Î£ A) â†’ Tmâ‚› (Ïƒ â‚‘âˆ˜â‚› Î´) t â‰¡ Tmâ‚› Î´ (Tmâ‚‘ Ïƒ t)
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ tt         = refl
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (t , u)    = _,_ & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ t âŠ— Tm-â‚‘âˆ˜â‚› Ïƒ Î´ u
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (Ï€â‚ t)     = Ï€â‚ & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ t
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (Ï€â‚‚ t)     = Ï€â‚‚ & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ t
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (pack e t) = pack & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ e âŠ— Tm-â‚‘âˆ˜â‚› Ïƒ Î´ t
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (appâº t u) = appâº & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ t âŠ— Tm-â‚‘âˆ˜â‚› Ïƒ Î´ u
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (if t u v) = if & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ t âŠ— Tm-â‚‘âˆ˜â‚› Ïƒ Î´ u âŠ— Tm-â‚‘âˆ˜â‚› Ïƒ Î´ v
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ false      = refl
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ true       = refl
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (var v)    = âˆˆ-â‚‘âˆ˜â‚› Ïƒ Î´ v
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (lam t)    = refl
Tm-â‚‘âˆ˜â‚› Ïƒ Î´ (app f a)  = app & Tm-â‚‘âˆ˜â‚› Ïƒ Î´ f âŠ— Tm-â‚‘âˆ˜â‚› Ïƒ Î´ a

âˆˆ-â‚›âˆ˜â‚‘ : âˆ€ {A Î“ Î” Î£}(Ïƒ : Sub Î” Î£)(Î´ : OPE Î“ Î”)(v : A âˆˆ Î£) â†’ âˆˆâ‚› (Ïƒ â‚›âˆ˜â‚‘ Î´) v â‰¡ Tmâ‚‘ Î´ (âˆˆâ‚› Ïƒ v)
âˆˆ-â‚›âˆ˜â‚‘ (Ïƒ , _) Î´ vz     = refl
âˆˆ-â‚›âˆ˜â‚‘ (Ïƒ , _) Î´ (vs v) = âˆˆ-â‚›âˆ˜â‚‘ Ïƒ Î´ v

Tm-â‚›âˆ˜â‚‘ : âˆ€ {A Î“ Î” Î£}(Ïƒ : Sub Î” Î£)(Î´ : OPE Î“ Î”)(t : Tm Î£ A) â†’ Tmâ‚› (Ïƒ â‚›âˆ˜â‚‘ Î´) t â‰¡ Tmâ‚‘ Î´ (Tmâ‚› Ïƒ t)
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ tt         = refl
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (t , u)    = _,_ & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ t âŠ— Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ u
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (Ï€â‚ t)     = Ï€â‚ & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ t
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (Ï€â‚‚ t)     = Ï€â‚‚ & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ t
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (pack e t) = pack & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ e âŠ— Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ t
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (appâº t u) = appâº & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ t âŠ— Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ u
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (if t u v) = if & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ t âŠ— Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ u âŠ— Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ v
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ false      = refl
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ true       = refl
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (var v)    = âˆˆ-â‚›âˆ˜â‚‘ Ïƒ Î´ v
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (lam t)    = refl
Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ (app f a)  = app & Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ f âŠ— Tm-â‚›âˆ˜â‚‘ Ïƒ Î´ a

assâ‚›â‚‘â‚› :
  âˆ€ {Î“ Î” Î£ Î}(Ïƒ : Sub Î£ Î)(Î´ : OPE Î” Î£)(Î½ : Sub Î“ Î”)
  â†’ (Ïƒ â‚›âˆ˜â‚‘ Î´) âˆ˜â‚› Î½ â‰¡ Ïƒ âˆ˜â‚› (Î´ â‚‘âˆ˜â‚› Î½)
assâ‚›â‚‘â‚› âˆ™       Î´ Î½ = refl
assâ‚›â‚‘â‚› (Ïƒ , t) Î´ Î½ = _,_ & assâ‚›â‚‘â‚› Ïƒ Î´ Î½ âŠ— (Tm-â‚‘âˆ˜â‚› Î´ Î½ t â»Â¹)

assâ‚›â‚›â‚‘ :
  âˆ€ {Î“ Î” Î£ Î}(Ïƒ : Sub Î£ Î)(Î´ : Sub Î” Î£)(Î½ : OPE Î“ Î”)
  â†’ (Ïƒ âˆ˜â‚› Î´) â‚›âˆ˜â‚‘ Î½ â‰¡ Ïƒ âˆ˜â‚› (Î´ â‚›âˆ˜â‚‘ Î½)
assâ‚›â‚›â‚‘ âˆ™       Î´ Î½ = refl
assâ‚›â‚›â‚‘ (Ïƒ , t) Î´ Î½ = _,_ & assâ‚›â‚›â‚‘ Ïƒ Î´ Î½ âŠ— (Tm-â‚›âˆ˜â‚‘ Î´ Î½ t â»Â¹)

âˆˆ-idâ‚› : âˆ€ {A Î“}(v : A âˆˆ Î“) â†’ âˆˆâ‚› idâ‚› v â‰¡ var v
âˆˆ-idâ‚› vz     = refl
âˆˆ-idâ‚› (vs v) = âˆˆ-â‚›âˆ˜â‚‘ idâ‚› wk v â—¾ Tmâ‚‘ wk & âˆˆ-idâ‚› v â—¾ (var âˆ˜ vs) & âˆˆ-idâ‚‘ v

âˆˆ-âˆ˜â‚› : âˆ€ {A Î“ Î” Î£}(Ïƒ : Sub Î” Î£)(Î´ : Sub Î“ Î”)(v : A âˆˆ Î£) â†’ âˆˆâ‚› (Ïƒ âˆ˜â‚› Î´) v â‰¡ Tmâ‚› Î´ (âˆˆâ‚› Ïƒ v)
âˆˆ-âˆ˜â‚› (Ïƒ , _) Î´ vz     = refl
âˆˆ-âˆ˜â‚› (Ïƒ , _) Î´ (vs v) = âˆˆ-âˆ˜â‚› Ïƒ Î´ v

Tm-idâ‚› : âˆ€ {A Î“}(t : Tm Î“ A) â†’ Tmâ‚› idâ‚› t â‰¡ t
Tm-idâ‚› tt         = refl
Tm-idâ‚› (t , u)    = _,_ & Tm-idâ‚› t âŠ— Tm-idâ‚› u
Tm-idâ‚› (Ï€â‚ t)     = Ï€â‚ & Tm-idâ‚› t
Tm-idâ‚› (Ï€â‚‚ t)     = Ï€â‚‚ & Tm-idâ‚› t
Tm-idâ‚› (pack e t) = pack & Tm-idâ‚› e âŠ— Tm-idâ‚› t
Tm-idâ‚› (appâº t u) = appâº & Tm-idâ‚› t âŠ— Tm-idâ‚› u
Tm-idâ‚› (if t u v) = if & Tm-idâ‚› t âŠ— Tm-idâ‚› u âŠ— Tm-idâ‚› v
Tm-idâ‚› false      = refl
Tm-idâ‚› true       = refl
Tm-idâ‚› (var v)    = âˆˆ-idâ‚› v
Tm-idâ‚› (lam t)    = refl
Tm-idâ‚› (app f a)  = app & Tm-idâ‚› f âŠ— Tm-idâ‚› a

Tm-âˆ˜â‚› : âˆ€ {A Î“ Î” Î£}(Ïƒ : Sub Î” Î£)(Î´ : Sub Î“ Î”)(t : Tm Î£ A) â†’ Tmâ‚› (Ïƒ âˆ˜â‚› Î´) t â‰¡ Tmâ‚› Î´ (Tmâ‚› Ïƒ t)
Tm-âˆ˜â‚› Ïƒ Î´ tt         = refl
Tm-âˆ˜â‚› Ïƒ Î´ (t , u)    = _,_ & Tm-âˆ˜â‚› Ïƒ Î´ t âŠ— Tm-âˆ˜â‚› Ïƒ Î´ u
Tm-âˆ˜â‚› Ïƒ Î´ (Ï€â‚ t)     = Ï€â‚ & Tm-âˆ˜â‚› Ïƒ Î´ t
Tm-âˆ˜â‚› Ïƒ Î´ (Ï€â‚‚ t)     = Ï€â‚‚ & Tm-âˆ˜â‚› Ïƒ Î´ t
Tm-âˆ˜â‚› Ïƒ Î´ (pack e t) = pack & Tm-âˆ˜â‚› Ïƒ Î´ e âŠ— Tm-âˆ˜â‚› Ïƒ Î´ t
Tm-âˆ˜â‚› Ïƒ Î´ (appâº t u) = appâº & Tm-âˆ˜â‚› Ïƒ Î´ t âŠ— Tm-âˆ˜â‚› Ïƒ Î´ u
Tm-âˆ˜â‚› Ïƒ Î´ (if t u v) = if & Tm-âˆ˜â‚› Ïƒ Î´ t âŠ— Tm-âˆ˜â‚› Ïƒ Î´ u âŠ— Tm-âˆ˜â‚› Ïƒ Î´ v
Tm-âˆ˜â‚› Ïƒ Î´ false      = refl
Tm-âˆ˜â‚› Ïƒ Î´ true       = refl
Tm-âˆ˜â‚› Ïƒ Î´ (var v)    = âˆˆ-âˆ˜â‚› Ïƒ Î´ v
Tm-âˆ˜â‚› Ïƒ Î´ (lam t)    = refl
Tm-âˆ˜â‚› Ïƒ Î´ (app f a)  = app & Tm-âˆ˜â‚› Ïƒ Î´ f âŠ— Tm-âˆ˜â‚› Ïƒ Î´ a

idrâ‚› : âˆ€ {Î“ Î”}(Ïƒ : Sub Î“ Î”) â†’ Ïƒ âˆ˜â‚› idâ‚› â‰¡ Ïƒ
idrâ‚› âˆ™       = refl
idrâ‚› (Ïƒ , t) = _,_ & idrâ‚› Ïƒ âŠ— Tm-idâ‚› t

idlâ‚› : âˆ€ {Î“ Î”}(Ïƒ : Sub Î“ Î”) â†’ idâ‚› âˆ˜â‚› Ïƒ â‰¡ Ïƒ
idlâ‚› âˆ™       = refl
idlâ‚› (Ïƒ , t) = (_, t) & (assâ‚›â‚‘â‚› idâ‚› wk (Ïƒ , t) â—¾ (idâ‚› âˆ˜â‚›_) & idlâ‚‘â‚› Ïƒ â—¾ idlâ‚› Ïƒ)

assâ‚› :
  âˆ€ {Î“ Î” Î£ Î}(Ïƒ : Sub Î£ Î)(Î´ : Sub Î” Î£)(Î½ : Sub Î“ Î”)
  â†’ (Ïƒ âˆ˜â‚› Î´) âˆ˜â‚› Î½ â‰¡ Ïƒ âˆ˜â‚› (Î´ âˆ˜â‚› Î½)
assâ‚› âˆ™       Î´ Î½ = refl
assâ‚› (Ïƒ , t) Î´ Î½ = _,_ & assâ‚› Ïƒ Î´ Î½ âŠ— (Tm-âˆ˜â‚› Î´ Î½ t â»Â¹)

âŒœidâ‚‘âŒ : âˆ€ {Î“} â†’ âŒœ idâ‚‘ {Î“} âŒáµ’áµ–áµ‰ â‰¡ idâ‚›
âŒœidâ‚‘âŒ {âˆ™}     = refl
âŒœidâ‚‘âŒ {Î“ â–¶ A} = (Î» x â†’ (x â‚›âˆ˜â‚‘ wk) , var vz) & âŒœidâ‚‘âŒ

âŒœâˆˆâ‚‘âŒ : âˆ€ {Î“ Î” A}(Ïƒ : OPE Î“ Î”)(x : A âˆˆ Î”) â†’ var (âˆˆâ‚‘ Ïƒ x) â‰¡ âˆˆâ‚› âŒœ Ïƒ âŒáµ’áµ–áµ‰ x
âŒœâˆˆâ‚‘âŒ âˆ™ ()
âŒœâˆˆâ‚‘âŒ (drop Ïƒ) x      = (var âˆ˜ vs) & (âˆˆ-idâ‚‘ _ â»Â¹) â—¾ Tmâ‚‘ wk & âŒœâˆˆâ‚‘âŒ Ïƒ x â—¾ âˆˆ-â‚›âˆ˜â‚‘ âŒœ Ïƒ âŒáµ’áµ–áµ‰ wk x â»Â¹
âŒœâˆˆâ‚‘âŒ (keep Ïƒ) vz     = refl
âŒœâˆˆâ‚‘âŒ (keep Ïƒ) (vs x) = (var âˆ˜ vs) & (âˆˆ-idâ‚‘ _ â»Â¹) â—¾ Tmâ‚‘ wk & âŒœâˆˆâ‚‘âŒ Ïƒ x â—¾ âˆˆ-â‚›âˆ˜â‚‘ âŒœ Ïƒ âŒáµ’áµ–áµ‰ wk x â»Â¹

âŒœTmâ‚‘âŒ : âˆ€ {Î“ Î” A}(Ïƒ : OPE Î“ Î”)(t : Tm Î” A) â†’ Tmâ‚‘ Ïƒ t â‰¡ Tmâ‚› âŒœ Ïƒ âŒáµ’áµ–áµ‰ t
âŒœTmâ‚‘âŒ Ïƒ (var x) = âŒœâˆˆâ‚‘âŒ Ïƒ x
âŒœTmâ‚‘âŒ Ïƒ tt = refl
âŒœTmâ‚‘âŒ Ïƒ true = refl
âŒœTmâ‚‘âŒ Ïƒ false = refl
âŒœTmâ‚‘âŒ Ïƒ (if t tâ‚ tâ‚‚) = if & âŒœTmâ‚‘âŒ Ïƒ t âŠ— âŒœTmâ‚‘âŒ Ïƒ tâ‚ âŠ— âŒœTmâ‚‘âŒ Ïƒ tâ‚‚
âŒœTmâ‚‘âŒ Ïƒ (Ï€â‚ t) = Ï€â‚ & âŒœTmâ‚‘âŒ Ïƒ t
âŒœTmâ‚‘âŒ Ïƒ (Ï€â‚‚ t) = Ï€â‚‚ & âŒœTmâ‚‘âŒ Ïƒ t
âŒœTmâ‚‘âŒ Ïƒ (t , tâ‚) = _,_ & âŒœTmâ‚‘âŒ Ïƒ t âŠ— âŒœTmâ‚‘âŒ Ïƒ tâ‚
âŒœTmâ‚‘âŒ Ïƒ (pack t tâ‚) = pack & âŒœTmâ‚‘âŒ Ïƒ t âŠ— âŒœTmâ‚‘âŒ Ïƒ tâ‚
âŒœTmâ‚‘âŒ Ïƒ (appâº t tâ‚) = appâº & âŒœTmâ‚‘âŒ Ïƒ t âŠ— âŒœTmâ‚‘âŒ Ïƒ tâ‚
âŒœTmâ‚‘âŒ Ïƒ (lam t) = refl
âŒœTmâ‚‘âŒ Ïƒ (app t tâ‚) = app & âŒœTmâ‚‘âŒ Ïƒ t âŠ— âŒœTmâ‚‘âŒ Ïƒ tâ‚


-- Conversion
--------------------------------------------------------------------------------

data _~_ {Î“} : âˆ€ {A} â†’ Tm Î“ A â†’ Tm Î“ A â†’ Set where
  Î²     : âˆ€ {A B}(t : Tm (âˆ™ â–¶ A) B) (t' : Tm Î“ A) â†’ app (lam t) t' ~ Tmâ‚› (âˆ™ , t') t
  Î·     : âˆ€ {A B}{t t' : Tm Î“ (A â‡’ B)} â†’ app (Tmâ‚‘ wk t) (var vz) ~ app (Tmâ‚‘ wk t') (var vz) â†’ t ~ t'
  lam   : âˆ€ {A B}{t t' : Tm (âˆ™ â–¶ A) B}  â†’ t ~ t' â†’  lam {Î“} t ~ lam t'
  app   : âˆ€ {A B}{t t' : Tm Î“ (A â‡’ B)}{u u'} â†’ t ~ t' â†’ u ~ u' â†’ app t u ~ app t' u'
  true  : âˆ€ {A}{t u : Tm Î“ A} â†’ if true  t u ~ t
  false : âˆ€ {A}{t u : Tm Î“ A} â†’ if false t u ~ u
  if    : âˆ€ {A}{t t' : Tm Î“ ğ”¹}{u u' v v' : Tm Î“ A} â†’ t ~ t' â†’ u ~ u' â†’ v ~ v' â†’ if t u v ~ if t' u' v'

  Ï€â‚    : âˆ€ {A B}{t t' : Tm Î“ (A * B)} â†’ t ~ t' â†’ Ï€â‚ t ~ Ï€â‚ t'
  Ï€â‚‚    : âˆ€ {A B}{t t' : Tm Î“ (A * B)} â†’ t ~ t' â†’ Ï€â‚‚ t ~ Ï€â‚‚ t'
  _,_   : âˆ€ {A B}{t t' : Tm Î“ A}{u u' : Tm Î“ B} â†’ t ~ t' â†’ u ~ u' â†’ (t , u) ~ (t' , u')
  Ï€â‚Î²   : âˆ€ {A B} t u â†’ Ï€â‚ {Î“}{A}{B} (t , u) ~ t
  Ï€â‚‚Î²   : âˆ€ {A B} t u â†’ Ï€â‚‚ {Î“}{A}{B} (t , u) ~ u
  ,Î·    : âˆ€ {A B}(t : Tm Î“ (A * B)) â†’ (Ï€â‚ t , Ï€â‚‚ t) ~ t

  ttÎ·   : âˆ€ {t} â†’ t ~ tt

  pack  : âˆ€ {E A B}{e e' : Tm Î“ E}{t t' : Tm Î“ (E * A â‡’ B)} â†’ e ~ e' â†’ t ~ t' â†’ pack e t ~ pack e' t'
  appâº  : âˆ€ {A B}{t t' : Tm Î“ (A â‡’âº B)}{u u'} â†’ t ~ t' â†’ u ~ u' â†’ appâº t u ~ appâº t' u'
  Î²á¶œ    : âˆ€ {A B E} e t t' â†’ appâº (pack {Î“}{A}{B}{E} e t) t' ~ app t (e , t')
  Î·á¶œ    : âˆ€ {A B}{t t' : Tm Î“ (A â‡’âº B)} â†’ appâº (Tmâ‚‘ wk t) (var vz) ~ appâº (Tmâ‚‘ wk t') (var vz) â†’ t ~ t'

  ~refl : âˆ€ {A}{t : Tm Î“ A} â†’ t ~ t
  _~â»Â¹  : âˆ€ {A}{t t' : Tm Î“ A} â†’ t ~ t' â†’ t' ~ t
  _~â—¾_  : âˆ€ {A}{t t' t'' : Tm Î“ A} â†’ t ~ t' â†’ t' ~ t'' â†’ t ~ t''

infixr 4 _~â—¾_
infix 6 _~â»Â¹

â‰¡~ : âˆ€ {Î“ A}{t t' : Tm Î“ A} â†’ t â‰¡ t' â†’ t ~ t'
â‰¡~ refl = ~refl

~â‚‘ : âˆ€ {Î“ Î” A}{t t' : Tm Î“ A}(Ïƒ : OPE Î” Î“) â†’ t ~ t' â†’ Tmâ‚‘ Ïƒ t ~ Tmâ‚‘ Ïƒ t'
~â‚‘ Ïƒ (Ï€â‚Î² t u) = Ï€â‚Î² (Tmâ‚‘ Ïƒ t) (Tmâ‚‘ Ïƒ u)
~â‚‘ Ïƒ (Ï€â‚‚Î² t u) = Ï€â‚‚Î² (Tmâ‚‘ Ïƒ t) (Tmâ‚‘ Ïƒ u)
~â‚‘ Ïƒ (,Î· t) = ,Î· (Tmâ‚‘ Ïƒ t)
~â‚‘ Ïƒ ttÎ· = ttÎ·
~â‚‘ Ïƒ (Î²á¶œ e t u) = Î²á¶œ (Tmâ‚‘ Ïƒ e) (Tmâ‚‘ Ïƒ t) (Tmâ‚‘ Ïƒ u)
~â‚‘ {t = t} {t'} Ïƒ (Î·á¶œ {A} {B} p) with ~â‚‘ (keep Ïƒ) p
... | hyp rewrite
      Tm-âˆ˜â‚‘ (wk{A}) (keep Ïƒ) t â»Â¹
    | Tm-âˆ˜â‚‘ (wk{A}) (keep Ïƒ) t' â»Â¹
    | idlâ‚‘ Ïƒ | idrâ‚‘ Ïƒ â»Â¹ | Tm-âˆ˜â‚‘ Ïƒ (wk{A}) t
    | Tm-âˆ˜â‚‘ Ïƒ (wk{A}) t' = coe ((Î» x â†’ Tmâ‚‘ x t ~ Tmâ‚‘ x t') & (idrâ‚‘ Ïƒ â»Â¹)) (Î·á¶œ hyp)
~â‚‘ Ïƒ (Ï€â‚ t)     = Ï€â‚ (~â‚‘ Ïƒ t)
~â‚‘ Ïƒ (Ï€â‚‚ t)     = Ï€â‚‚ (~â‚‘ Ïƒ t)
~â‚‘ Ïƒ (t , u)    = ~â‚‘ Ïƒ t , ~â‚‘ Ïƒ u
~â‚‘ Ïƒ (pack e t) = pack (~â‚‘ Ïƒ e) (~â‚‘ Ïƒ t)
~â‚‘ Ïƒ (appâº t u) = appâº (~â‚‘ Ïƒ t) (~â‚‘ Ïƒ u)
~â‚‘ {t = t} {t'} Ïƒ (Î· {A} {B} p) with ~â‚‘ (keep Ïƒ) p
... | hyp rewrite
      Tm-âˆ˜â‚‘ (wk{A}) (keep Ïƒ) t â»Â¹
    | Tm-âˆ˜â‚‘ (wk{A}) (keep Ïƒ) t' â»Â¹
    | idlâ‚‘ Ïƒ | idrâ‚‘ Ïƒ â»Â¹ | Tm-âˆ˜â‚‘ Ïƒ (wk{A}) t
    | Tm-âˆ˜â‚‘ Ïƒ (wk{A}) t' = coe ((Î» x â†’ Tmâ‚‘ x t ~ Tmâ‚‘ x t') & (idrâ‚‘ Ïƒ â»Â¹)) (Î· hyp)
~â‚‘ Ïƒ (Î² t t') rewrite Tm-â‚›âˆ˜â‚‘ (âˆ™ , t') Ïƒ t â»Â¹ = Î² t (Tmâ‚‘ Ïƒ t')

~â‚‘ Ïƒ (lam t~t')       = lam t~t'
~â‚‘ Ïƒ (app t~t' x~x')  = app (~â‚‘ Ïƒ t~t') (~â‚‘ Ïƒ x~x')
~â‚‘ Ïƒ ~refl            = ~refl
~â‚‘ Ïƒ (t~t' ~â»Â¹)       = ~â‚‘ Ïƒ t~t' ~â»Â¹
~â‚‘ Ïƒ (t~t' ~â—¾ t'~t'') = ~â‚‘ Ïƒ t~t' ~â—¾ ~â‚‘ Ïƒ t'~t''
~â‚‘ Ïƒ true             = true
~â‚‘ Ïƒ false            = false
~â‚‘ Ïƒ (if t u v)       = if (~â‚‘ Ïƒ t) (~â‚‘ Ïƒ u) (~â‚‘ Ïƒ v)

infix 3 _~â‚›_
data _~â‚›_ {Î“} : âˆ€ {Î”} â†’ Sub Î“ Î” â†’ Sub Î“ Î” â†’ Set where
  âˆ™   : âˆ™ ~â‚› âˆ™
  _,_ : âˆ€ {Î” A}{Ïƒ Ïƒ' : Sub Î“ Î”}{t t' : Tm Î“ A} â†’ Ïƒ ~â‚› Ïƒ' â†’ t ~ t' â†’ (Ïƒ , t) ~â‚› (Ïƒ' , t')

infixr 4 _~â‚›â—¾_
_~â‚›â—¾_ : âˆ€ {Î“ Î”}{Ïƒ Î´ Î½ : Sub Î“ Î”} â†’ Ïƒ ~â‚› Î´ â†’ Î´ ~â‚› Î½ â†’ Ïƒ ~â‚› Î½
âˆ™       ~â‚›â—¾ âˆ™        = âˆ™
(p , t) ~â‚›â—¾ (q , t') = (p ~â‚›â—¾ q) , (t ~â—¾ t')

_~â‚›â»Â¹ : âˆ€ {Î“ Î”}{Ïƒ Î´ : Sub Î“ Î”} â†’ Ïƒ ~â‚› Î´ â†’ Î´ ~â‚› Ïƒ
âˆ™       ~â‚›â»Â¹ = âˆ™
(p , x) ~â‚›â»Â¹ = (p ~â‚›â»Â¹) , (x ~â»Â¹)

~â‚›âˆ˜â‚‘ : âˆ€ {Î“ Î” Î£}{Ïƒ Ïƒ' : Sub Î” Î£} â†’ Ïƒ ~â‚› Ïƒ' â†’ (Î´ : OPE Î“ Î”) â†’ (Ïƒ â‚›âˆ˜â‚‘ Î´) ~â‚› (Ïƒ' â‚›âˆ˜â‚‘ Î´)
~â‚›âˆ˜â‚‘ âˆ™       Î´ = âˆ™
~â‚›âˆ˜â‚‘ (p , t) Î´ = ~â‚›âˆ˜â‚‘ p Î´ , ~â‚‘ Î´ t

âˆˆâ‚›~x : âˆ€ {Î“ Î” A}{Ïƒ Ïƒ' : Sub Î“ Î”} â†’ Ïƒ ~â‚› Ïƒ' â†’ (x : A âˆˆ Î”) â†’ âˆˆâ‚› Ïƒ x ~ âˆˆâ‚› Ïƒ' x
âˆˆâ‚›~x (p , t) vz = t
âˆˆâ‚›~x (p , t) (vs x) = âˆˆâ‚›~x p x

Tmâ‚›~t : âˆ€ {Î“ Î” A}{Ïƒ Ïƒ' : Sub Î“ Î”} â†’ Ïƒ ~â‚› Ïƒ' â†’ (t : Tm Î” A) â†’ Tmâ‚› Ïƒ t ~ Tmâ‚› Ïƒ' t
Tmâ‚›~t p (var x) = âˆˆâ‚›~x p x
Tmâ‚›~t p tt = ~refl
Tmâ‚›~t p true = ~refl
Tmâ‚›~t p false = ~refl
Tmâ‚›~t p (if t tâ‚ tâ‚‚) = if (Tmâ‚›~t p t) (Tmâ‚›~t p tâ‚) (Tmâ‚›~t p tâ‚‚)
Tmâ‚›~t p (Ï€â‚ t) = Ï€â‚ (Tmâ‚›~t p t)
Tmâ‚›~t p (Ï€â‚‚ t) = Ï€â‚‚ (Tmâ‚›~t p t)
Tmâ‚›~t p (t , tâ‚) = Tmâ‚›~t p t , Tmâ‚›~t p tâ‚
Tmâ‚›~t p (pack t tâ‚) = pack (Tmâ‚›~t p t) (Tmâ‚›~t p tâ‚)
Tmâ‚›~t p (appâº t tâ‚) = appâº (Tmâ‚›~t p t) (Tmâ‚›~t p tâ‚)
Tmâ‚›~t p (lam t) = ~refl
Tmâ‚›~t p (app t tâ‚) = app (Tmâ‚›~t p t) (Tmâ‚›~t p tâ‚)

Tmâ‚›Ïƒ~ : âˆ€ {Î“ Î” A}(Ïƒ : Sub Î“ Î”){t t' : Tm Î” A}  â†’ t ~ t' â†’ Tmâ‚› Ïƒ t ~ Tmâ‚› Ïƒ t'
Tmâ‚›Ïƒ~ Ïƒ (Î² t t') = Î² t (Tmâ‚› Ïƒ t') ~â—¾ â‰¡~ (Tm-âˆ˜â‚› (âˆ™ , t') Ïƒ t)
Tmâ‚›Ïƒ~ Ïƒ {t} {t'} (Î· {A} {B} p) with Tmâ‚›Ïƒ~ (keepâ‚› Ïƒ) p
... | hyp rewrite Tm-â‚‘âˆ˜â‚› (wk{A}) (keepâ‚› Ïƒ) t â»Â¹ | Tm-â‚‘âˆ˜â‚› (wk{A}) (keepâ‚› Ïƒ) t' â»Â¹
          | idlâ‚‘â‚› (Ïƒ â‚›âˆ˜â‚‘ (wk{A})) | Tm-â‚›âˆ˜â‚‘ Ïƒ (wk{A}) t | Tm-â‚›âˆ˜â‚‘ Ïƒ (wk{A}) t'
          = Î· hyp
Tmâ‚›Ïƒ~ Ïƒ (lam p) = lam p
Tmâ‚›Ïƒ~ Ïƒ (app p pâ‚) = app (Tmâ‚›Ïƒ~ Ïƒ p) (Tmâ‚›Ïƒ~ Ïƒ pâ‚)
Tmâ‚›Ïƒ~ Ïƒ true = true
Tmâ‚›Ïƒ~ Ïƒ false = false
Tmâ‚›Ïƒ~ Ïƒ (if p pâ‚ pâ‚‚) = if (Tmâ‚›Ïƒ~ Ïƒ p) (Tmâ‚›Ïƒ~ Ïƒ pâ‚) (Tmâ‚›Ïƒ~ Ïƒ pâ‚‚)
Tmâ‚›Ïƒ~ Ïƒ (Ï€â‚ p) = Ï€â‚ (Tmâ‚›Ïƒ~ Ïƒ p)
Tmâ‚›Ïƒ~ Ïƒ (Ï€â‚‚ p) = Ï€â‚‚ (Tmâ‚›Ïƒ~ Ïƒ p)
Tmâ‚›Ïƒ~ Ïƒ (p , pâ‚) = Tmâ‚›Ïƒ~ Ïƒ p , Tmâ‚›Ïƒ~ Ïƒ pâ‚
Tmâ‚›Ïƒ~ Ïƒ (Ï€â‚Î² t u) = Ï€â‚Î² (Tmâ‚› Ïƒ t) (Tmâ‚› Ïƒ u)
Tmâ‚›Ïƒ~ Ïƒ (Ï€â‚‚Î² t u) = Ï€â‚‚Î² (Tmâ‚› Ïƒ t) (Tmâ‚› Ïƒ u)
Tmâ‚›Ïƒ~ Ïƒ (,Î· t) = ,Î· (Tmâ‚› Ïƒ t)
Tmâ‚›Ïƒ~ Ïƒ ttÎ· = ttÎ·
Tmâ‚›Ïƒ~ Ïƒ (pack p pâ‚) = pack (Tmâ‚›Ïƒ~ Ïƒ p) (Tmâ‚›Ïƒ~ Ïƒ pâ‚)
Tmâ‚›Ïƒ~ Ïƒ (appâº p pâ‚) = appâº (Tmâ‚›Ïƒ~ Ïƒ p) (Tmâ‚›Ïƒ~ Ïƒ pâ‚)
Tmâ‚›Ïƒ~ Ïƒ (Î²á¶œ e t t') = Î²á¶œ (Tmâ‚› Ïƒ e) (Tmâ‚› Ïƒ t) (Tmâ‚› Ïƒ t')
Tmâ‚›Ïƒ~ Ïƒ {t} {t'} (Î·á¶œ {A} {B} p) with Tmâ‚›Ïƒ~ (keepâ‚› Ïƒ) p
... | hyp rewrite Tm-â‚‘âˆ˜â‚› (wk{A}) (keepâ‚› Ïƒ) t â»Â¹ | Tm-â‚‘âˆ˜â‚› (wk{A}) (keepâ‚› Ïƒ) t' â»Â¹
          | idlâ‚‘â‚› (Ïƒ â‚›âˆ˜â‚‘ (wk{A})) | Tm-â‚›âˆ˜â‚‘ Ïƒ (wk{A}) t | Tm-â‚›âˆ˜â‚‘ Ïƒ (wk{A}) t'
          = Î·á¶œ hyp
Tmâ‚›Ïƒ~ Ïƒ ~refl = ~refl
Tmâ‚›Ïƒ~ Ïƒ (p ~â»Â¹) = Tmâ‚›Ïƒ~ Ïƒ p ~â»Â¹
Tmâ‚›Ïƒ~ Ïƒ (p ~â—¾ pâ‚) = Tmâ‚›Ïƒ~ Ïƒ p ~â—¾ Tmâ‚›Ïƒ~ Ïƒ pâ‚

Tmâ‚›~~ : âˆ€ {Î“ Î” A}{t t' : Tm Î” A}{Ïƒ Ïƒ' : Sub Î“ Î”} â†’ Ïƒ ~â‚› Ïƒ' â†’ t ~ t' â†’ Tmâ‚› Ïƒ t ~ Tmâ‚› Ïƒ' t'
Tmâ‚›~~ {t = t} {Ïƒ' = Ïƒ'} p q = Tmâ‚›~t p t ~â—¾ Tmâ‚›Ïƒ~ Ïƒ' q

~âˆ˜â‚›~ : âˆ€ {Î“ Î” Î£}{Ïƒ Ïƒ' : Sub Î” Î£} â†’ Ïƒ ~â‚› Ïƒ' â†’ {Î´ Î´' : Sub Î“ Î”} â†’ Î´ ~â‚› Î´' â†’ (Ïƒ âˆ˜â‚› Î´) ~â‚› (Ïƒ' âˆ˜â‚› Î´')
~âˆ˜â‚›~ âˆ™       q = âˆ™
~âˆ˜â‚›~ (p , t) q = ~âˆ˜â‚›~ p q , Tmâ‚›~~ q t

~â‚›refl : âˆ€ {Î“ Î”}(Ïƒ : Sub Î“ Î”) â†’ Ïƒ ~â‚› Ïƒ
~â‚›refl âˆ™       = âˆ™
~â‚›refl (Ïƒ , _) = ~â‚›refl _ , ~refl

â‰¡~â‚› : âˆ€ {Î“ Î”}{Ïƒ Î´ : Sub Î“ Î”} â†’ Ïƒ â‰¡ Î´ â†’ Ïƒ ~â‚› Î´
â‰¡~â‚› refl = ~â‚›refl _

head : âˆ€ {Î“ Î” A} â†’ Sub Î“ (Î” â–¶ A) â†’ Tm Î“ A
head (Ïƒ , t) = t

tail : âˆ€ {Î“ Î” A} â†’ Sub Î“ (Î” â–¶ A) â†’ Sub Î“ Î”
tail (Ïƒ , _) = Ïƒ

dropâ‚›~ : âˆ€ {Î“ Î” A}{Ïƒ Ïƒ' : Sub Î“ Î”} â†’ Ïƒ ~â‚› Ïƒ' â†’ dropâ‚› {A} Ïƒ ~â‚› dropâ‚› Ïƒ'
dropâ‚›~ p = ~â‚›âˆ˜â‚‘ p wk

keepâ‚›~ : âˆ€ {Î“ Î” A}{Ïƒ Ïƒ' : Sub Î“ Î”} â†’ Ïƒ ~â‚› Ïƒ' â†’ keepâ‚› {A} Ïƒ ~â‚› keepâ‚› Ïƒ'
keepâ‚›~ p = dropâ‚›~ p , ~refl

Tmâ‚‘head : âˆ€ {Î“ Î” Î£ A}(Î´ : OPE Î£ Î“)(Ïƒ : Sub Î“ (Î” â–¶ A)) â†’ Tmâ‚‘ Î´ (head Ïƒ) â‰¡ head (Ïƒ â‚›âˆ˜â‚‘ Î´)
Tmâ‚‘head Î´ (Ïƒ , x) = refl

âˆ™â‚›Î· : âˆ€ {Î“}(Ïƒ : Sub Î“ âˆ™) â†’ Ïƒ â‰¡ âˆ™
âˆ™â‚›Î· âˆ™ = refl

,â‚›Î· : âˆ€ {Î“ Î” A}(t : Sub Î“ (Î” â–¶ A)) â†’ (tail t , head t) â‰¡ t
,â‚›Î· (Ïƒ , t) = refl

-- -- Standard model
-- --------------------------------------------------------------------------------

-- âŸ¦_âŸ§Ty : Ty â†’ Set
-- âŸ¦ Top    âŸ§Ty = âŠ¤
-- âŸ¦ A * B  âŸ§Ty = âŸ¦ A âŸ§Ty Ã— âŸ¦ B âŸ§Ty
-- âŸ¦ A â‡’âº B âŸ§Ty = âŸ¦ A âŸ§Ty â†’ âŸ¦ B âŸ§Ty
-- âŸ¦ ğ”¹      âŸ§Ty = Bool
-- âŸ¦ A â‡’ B  âŸ§Ty = âŸ¦ A âŸ§Ty â†’ âŸ¦ B âŸ§Ty

-- âŸ¦_âŸ§Con : Con â†’ Set
-- âŸ¦ âˆ™     âŸ§Con = âŠ¤
-- âŸ¦ Î“ â–¶ A âŸ§Con = âŸ¦ Î“ âŸ§Con Ã— âŸ¦ A âŸ§Ty

-- âŸ¦_âŸ§Tm : âˆ€ {Î“ A} â†’ Tm Î“ A â†’ âŸ¦ Î“ âŸ§Con â†’ âŸ¦ A âŸ§Ty
-- âŸ¦ tt         âŸ§Tm Î³ = tt
-- âŸ¦ Ï€â‚ t       âŸ§Tm Î³ = â‚ (âŸ¦ t âŸ§Tm Î³)
-- âŸ¦ Ï€â‚‚ t       âŸ§Tm Î³ = â‚‚ (âŸ¦ t âŸ§Tm Î³)
-- âŸ¦ t , u      âŸ§Tm Î³ = âŸ¦ t âŸ§Tm Î³ , âŸ¦ u âŸ§Tm Î³
-- âŸ¦ pack e t   âŸ§Tm Î³ = Î» Î± â†’ âŸ¦ t âŸ§Tm Î³ (âŸ¦ e âŸ§Tm Î³ , Î±)
-- âŸ¦ appâº t u   âŸ§Tm Î³ = âŸ¦ t âŸ§Tm Î³ (âŸ¦ u âŸ§Tm Î³)
-- âŸ¦ var vz     âŸ§Tm Î³ = â‚‚ Î³
-- âŸ¦ var (vs x) âŸ§Tm Î³ = âŸ¦ var x âŸ§Tm (â‚ Î³)
-- âŸ¦ lam t      âŸ§Tm Î³ = Î» Î± â†’ âŸ¦ t âŸ§Tm (tt , Î±)
-- âŸ¦ app t u    âŸ§Tm Î³ = âŸ¦ t âŸ§Tm Î³ (âŸ¦ u âŸ§Tm Î³)
-- âŸ¦ true       âŸ§Tm Î³ = true
-- âŸ¦ false      âŸ§Tm Î³ = false
-- âŸ¦ if t u v   âŸ§Tm Î³ = if âŸ¦ t âŸ§Tm Î³ then âŸ¦ u âŸ§Tm Î³ else âŸ¦ v âŸ§Tm Î³

-- âŸ¦_âŸ§OPE : âˆ€ {Î“ Î”} â†’ OPE Î“ Î” â†’ âŸ¦ Î“ âŸ§Con â†’ âŸ¦ Î” âŸ§Con
-- âŸ¦ âˆ™      âŸ§OPE Î³ = tt
-- âŸ¦ drop Ïƒ âŸ§OPE Î³ = âŸ¦ Ïƒ âŸ§OPE (â‚ Î³)
-- âŸ¦ keep Ïƒ âŸ§OPE Î³ = âŸ¦ Ïƒ âŸ§OPE (â‚ Î³) , â‚‚ Î³

-- âŸ¦_âŸ§Sub : âˆ€ {Î“ Î”} â†’ Sub Î“ Î” â†’ âŸ¦ Î“ âŸ§Con â†’ âŸ¦ Î” âŸ§Con
-- âŸ¦ âˆ™     âŸ§Sub Î³ = tt
-- âŸ¦ Ïƒ , t âŸ§Sub Î³ = âŸ¦ Ïƒ âŸ§Sub Î³ , âŸ¦ t âŸ§Tm Î³

-- âŸ¦idâ‚‘âŸ§ : âˆ€ {Î“} â†’ âŸ¦ idâ‚‘ {Î“} âŸ§OPE â‰¡ id
-- âŸ¦idâ‚‘âŸ§ {âˆ™}     = refl
-- âŸ¦idâ‚‘âŸ§ {Î“ â–¶ A} rewrite âŸ¦idâ‚‘âŸ§ {Î“} = refl

-- âŸ¦âˆˆâ‚‘âŸ§ : âˆ€ {Î“ Î” A}(Ïƒ : OPE Î“ Î”)(x : A âˆˆ Î”) â†’ âŸ¦ var (âˆˆâ‚‘ Ïƒ x) âŸ§Tm â‰¡ âŸ¦ var x âŸ§Tm âˆ˜ âŸ¦ Ïƒ âŸ§OPE
-- âŸ¦âˆˆâ‚‘âŸ§ âˆ™ ()
-- âŸ¦âˆˆâ‚‘âŸ§ (drop Ïƒ) x rewrite âŸ¦âˆˆâ‚‘âŸ§ Ïƒ x = refl
-- âŸ¦âˆˆâ‚‘âŸ§ (keep Ïƒ) vz = refl
-- âŸ¦âˆˆâ‚‘âŸ§ (keep Ïƒ) (vs x) rewrite âŸ¦âˆˆâ‚‘âŸ§ Ïƒ x = refl

-- âŸ¦Tmâ‚‘âŸ§ : âˆ€ {Î“ Î” A}(Ïƒ : OPE Î“ Î”)(t : Tm Î” A) â†’ âŸ¦ Tmâ‚‘ Ïƒ t âŸ§Tm â‰¡ âŸ¦ t âŸ§Tm âˆ˜ âŸ¦ Ïƒ âŸ§OPE
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ tt       = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (Ï€â‚ t)     rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ t = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (Ï€â‚‚ t)     rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ t = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (t , u)    rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ t | âŸ¦Tmâ‚‘âŸ§ Ïƒ u = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (pack e t) rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ e | âŸ¦Tmâ‚‘âŸ§ Ïƒ t = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (appâº t u) rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ t | âŸ¦Tmâ‚‘âŸ§ Ïƒ u = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (var x) = âŸ¦âˆˆâ‚‘âŸ§ Ïƒ x
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (lam t) = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (app t u) rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ t | âŸ¦Tmâ‚‘âŸ§ Ïƒ u = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ true = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ false = refl
-- âŸ¦Tmâ‚‘âŸ§ Ïƒ (if t u v) rewrite âŸ¦Tmâ‚‘âŸ§ Ïƒ t | âŸ¦Tmâ‚‘âŸ§ Ïƒ u | âŸ¦Tmâ‚‘âŸ§ Ïƒ v = refl

-- âŸ¦â‚›âˆ˜â‚‘âŸ§ : âˆ€ {Î“ Î” Î£} (Ïƒ : Sub Î” Î£)(Î´ : OPE Î“ Î”) â†’ âŸ¦ Ïƒ â‚›âˆ˜â‚‘ Î´ âŸ§Sub â‰¡ âŸ¦ Ïƒ âŸ§Sub âˆ˜ âŸ¦ Î´ âŸ§OPE
-- âŸ¦â‚›âˆ˜â‚‘âŸ§ âˆ™       Î´ = refl
-- âŸ¦â‚›âˆ˜â‚‘âŸ§ (Ïƒ , t) Î´ rewrite âŸ¦â‚›âˆ˜â‚‘âŸ§ Ïƒ Î´ | âŸ¦Tmâ‚‘âŸ§ Î´ t = refl

-- âŸ¦âˆˆâ‚›âŸ§ : âˆ€ {Î“ Î” A}(Ïƒ : Sub Î“ Î”)(x : A âˆˆ Î”) â†’ âŸ¦ âˆˆâ‚› Ïƒ x âŸ§Tm â‰¡ âŸ¦ var x âŸ§Tm âˆ˜ âŸ¦ Ïƒ âŸ§Sub
-- âŸ¦âˆˆâ‚›âŸ§ (Ïƒ , x) vz     = refl
-- âŸ¦âˆˆâ‚›âŸ§ (Ïƒ , _) (vs x) = âŸ¦âˆˆâ‚›âŸ§ Ïƒ x

-- âŸ¦Tmâ‚›âŸ§ : âˆ€ {Î“ Î” A}(Ïƒ : Sub Î“ Î”)(t : Tm Î” A) â†’ âŸ¦ Tmâ‚› Ïƒ t âŸ§Tm â‰¡ âŸ¦ t âŸ§Tm âˆ˜ âŸ¦ Ïƒ âŸ§Sub
-- âŸ¦Tmâ‚›âŸ§ Ïƒ tt = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (Ï€â‚ t)     rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ t = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (Ï€â‚‚ t)     rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ t = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (t , u)    rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ t | âŸ¦Tmâ‚›âŸ§ Ïƒ u = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (pack e t) rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ e | âŸ¦Tmâ‚›âŸ§ Ïƒ t = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (appâº t u) rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ t | âŸ¦Tmâ‚›âŸ§ Ïƒ u = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (var x) = âŸ¦âˆˆâ‚›âŸ§ Ïƒ x
-- âŸ¦Tmâ‚›âŸ§ {Î“} Ïƒ (lam {A} t) = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (app t u) rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ t | âŸ¦Tmâ‚›âŸ§ Ïƒ u = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ true = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ false = refl
-- âŸ¦Tmâ‚›âŸ§ Ïƒ (if t u v) rewrite âŸ¦Tmâ‚›âŸ§ Ïƒ t | âŸ¦Tmâ‚›âŸ§ Ïƒ u | âŸ¦Tmâ‚›âŸ§ Ïƒ v = refl

-- âŸ¦idâ‚›âŸ§ : âˆ€ {Î“} â†’ âŸ¦ idâ‚› {Î“} âŸ§Sub â‰¡ id
-- âŸ¦idâ‚›âŸ§ {âˆ™}     = refl
-- âŸ¦idâ‚›âŸ§ {Î“ â–¶ A} rewrite âŸ¦â‚›âˆ˜â‚‘âŸ§ (idâ‚›{Î“}) (wk{A}) | âŸ¦idâ‚›âŸ§ {Î“} | âŸ¦idâ‚‘âŸ§{Î“} = refl

-- âŸ¦~âŸ§ : âˆ€ {Î“ A}{t t' : Tm Î“ A} â†’ t ~ t' â†’ âŸ¦ t âŸ§Tm â‰¡ âŸ¦ t' âŸ§Tm
-- âŸ¦~âŸ§ (Ï€â‚Î² t u) = refl
-- âŸ¦~âŸ§ (Ï€â‚‚Î² t u) = refl
-- âŸ¦~âŸ§ (,Î· t) = refl
-- âŸ¦~âŸ§ ttÎ· = refl
-- âŸ¦~âŸ§ (Î²á¶œ e t u) = refl
-- âŸ¦~âŸ§ {Î“}{t = t} {t'} (Î·á¶œ {A}{B} p) with âŸ¦~âŸ§ p
-- ... | foo rewrite âŸ¦Tmâ‚‘âŸ§ (wk{A}) t | âŸ¦Tmâ‚‘âŸ§ (wk{A}) t' | âŸ¦idâ‚‘âŸ§{Î“} = curry & foo
-- âŸ¦~âŸ§ (Ï€â‚ t) rewrite âŸ¦~âŸ§ t = refl
-- âŸ¦~âŸ§ (Ï€â‚‚ t) rewrite âŸ¦~âŸ§ t = refl
-- âŸ¦~âŸ§ (t , u) rewrite âŸ¦~âŸ§ t | âŸ¦~âŸ§ u = refl
-- âŸ¦~âŸ§ (pack e t) rewrite âŸ¦~âŸ§ e | âŸ¦~âŸ§ t = refl
-- âŸ¦~âŸ§ (appâº t u) rewrite âŸ¦~âŸ§ t | âŸ¦~âŸ§ u = refl
-- âŸ¦~âŸ§ {Î“} {B} (Î² {A} t u) rewrite âŸ¦Tmâ‚›âŸ§ (âˆ™ , u) t = refl
-- âŸ¦~âŸ§ {Î“} {t = tâ‚} {t'} (Î· {A} {B} t) with âŸ¦~âŸ§ t
-- ... | foo rewrite âŸ¦Tmâ‚‘âŸ§ (wk{A}) tâ‚ | âŸ¦Tmâ‚‘âŸ§ (wk{A}) t' | âŸ¦idâ‚‘âŸ§{Î“} = curry & foo
-- âŸ¦~âŸ§ (lam p)   rewrite âŸ¦~âŸ§ p = refl
-- âŸ¦~âŸ§ (app t u) rewrite âŸ¦~âŸ§ t | âŸ¦~âŸ§ u = refl
-- âŸ¦~âŸ§ ~refl      = refl
-- âŸ¦~âŸ§ (p ~â»Â¹)    = âŸ¦~âŸ§ p â»Â¹
-- âŸ¦~âŸ§ (p ~â—¾ q)   = âŸ¦~âŸ§ p â—¾ âŸ¦~âŸ§ q
-- âŸ¦~âŸ§ true       = refl
-- âŸ¦~âŸ§ false      = refl
-- âŸ¦~âŸ§ (if t u v) rewrite âŸ¦~âŸ§ t | âŸ¦~âŸ§ u | âŸ¦~âŸ§ v = refl
